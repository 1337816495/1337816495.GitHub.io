---
typora-root-url: ..\..
---

# 合成器线程

## 概述

TODO：描述不当。本文将会介绍合成器线程会如何处理页面的输入事件，以及有哪些优化技巧可以保障页面的流畅度。

## 什么是输入事件

对浏览器而言，输入事件是指诸如点击鼠标、触摸屏幕、键入文本、滚动滚轮等行为，因此输入事件的真正含义是指用户与浏览器进行的交互，而不是通俗理解的“输入”。

我们在屏幕中看到的浏览器的画面其实是一幅位图，当浏览器接收到来自用户的输入事件后，它就会迅速的更新这幅位图，于是用户便产生了“浏览器响应了我的操作”这种错觉。比如，当用户滚动页面时，浏览器就会频繁的根据页面滚动后的新位置来生成新的页面位图，并替换掉旧的页面位图。当这个更新的频率足够高且时间间隔均匀时，用户就会感觉到画面的动画很流畅，反之则会感觉到画面的动画很卡顿，卡顿（jank）的本质是更新的延迟。

> 我不确定浏览器的画面到底是一幅完整的位图，还是由多幅位图拼接而成的拼图，因为 Chrome Blog 提到过浏览器 UI 的位图和选项卡页面的位图是分开生成的，不过哪怕不知道这个问题的答案，也不会影响我们理解这篇文章，所以暂勿纠结。

## 如何处理输入事件

通过《页面的渲染》一文可知，合成器线程可以通过改变图块位图的状态（比如位置、旋转等）来让 GPU 合成出新的页面位图，相比于 Chrome 最初的渲染策略，这种渲染策略的效率更高，一是因为这样子的工作量显然更小，二是因为合成器线程是独立于主线程之外的另一条线程，它可以在主线程工作的同时执行页面渲染的任务，而不用担心被主线程阻塞。





当用户与浏览器交互时，浏览器就会捕获这个输入事件，然后将该事件的类型（如 `click`）与坐标（如 `(x,y)`） 发送给渲染进程。





