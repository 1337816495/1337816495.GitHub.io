# TCP协议

## IP

数据包要在互联网上进行传输，就需要符合网际协议（Internet Protocol，简称 IP）标准，IP 的作用就是将数据包传送至目标主机。互联网上的每台主机都拥有唯一的 IP 地址，这是一个数字地址。

访问网站实际上是一台主机向另一台主机请求信息，比如，如果主机 A 要把数据包发送给主机 B，那么在发送之前，就要为数据包附加上主机 B 的 IP 地址，这样数据包才知道应当发往何处。另外，数据包还会附加上主机 A 的 IP 地址，这样主机 B 才能回复信息给主机 A。这两种附加信息都会被装进一个名为 IP 头的数据结构里，IP 头就是 IP 数据包开头的信息，它不仅包含 `源 IP 地址` 和 `目标 IP 地址`，它还包含 `IP 版本` 和 `生存时间` 等信息。

主机 A 将数据包发送给主机 B 的具体流程是：

1. 主机 A 的上层将原始数据包交给网络层。
2. 网络层为原始数据包添加 IP 头，组成了新的 IP 数据包，然后交给底层。
3. 底层通过物理设备将 IP 数据包传输给主机 B的网络层。
4. 主机 B 的网络层拆除 IP 数据包的 IP 头，获得原始数据包，最后将原始数据包交给上层。

## UDP

IP 只负责将数据包传送至目标主机，但是目标主机并不知道应该将数据包交付给哪个应用程序，因此还缺少一种能和应用程序打交道的协议，用户数据包协议（User Datagram Protocol，简称 UDP）便是其中一种。

任何想要访问网络的应用程序都需要绑定一个唯一的端口号，UDP 正是通过端口号来确定应该将数据包交付给哪个应用程序的，端口号其实就是一个数字，比如 `http://localhost:443` 中的 `443` 就是一个端口号。

和 IP 的行为一样，UDP 也会为数据包封装一个 UDP 头，其内包含了 `源端口号` 和 `目标端口号`。

那么，主机 A 将数据包发送给主机 B 的具体流程就更新为：

1. 主机 A 的上层将原始数据包交给网络层。
2. 传输层为原始数据包添加 UDP 头，组成了新的 UDP 数据包，然后交给网络层。
3. 网络层为 UDP 数据包添加 IP 头，组成了新的 IP 数据包，然后交给底层。
4. 底层通过物理设备将 IP 数据包传输给主机 B 的网络层。
5. 主机 B 的网络层拆除 IP 数据包的 IP 头，获得了 UDP 数据包，然后将 UDP 数据包交给传输层。
6. 主机 B 的传输层拆除 UDP 数据包的 UDP 头，获得了原始数据包，然后根据 UDP 头中的端口号来将原始数据包交给上层的应用程序。

UDP 具有校验数据包是否正确的能力，但是对于出错的数据包，UDP 却并不提供重发机制，而是直接丢弃它们，另外 UDP 也不能确定数据包是否成功的到达了目的地，因此 UDP 无法保证数据的可靠性，不过 UDP 的传输速度却非常快，所以 UDP 经常会应用在一些关注速度，但不那么严格要求数据完整性的领域，比如在线视频、互动游戏等。

## TCP

https://time.geekbang.org/column/article/113550