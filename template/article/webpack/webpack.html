<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webpack 5</title>
</head>

<body>
    <header>
        <button class="catalogue"><a href="/catalogue.html"><strong>CATALOGUE</strong></a></button>
        <button class="homepage"><a href="/index.html"><strong>HOMEPAGE</strong></a></button>
    </header>
    <aside>
        <p><a href="#">IN THIS ARTICLE</a></p>
        <p data-level="1"><a href="#0182cabf-6d0e-48b5-b06e-2c9c91fa53b6">概念</a></p>
        <p data-level="2"><a href="#2ef60518-166f-4594-aea5-1d84fb40ad9f">entry</a></p>
        <p data-level="2"><a href="#ee0f70da-f7b7-439b-960d-278e94f9972a">output</a></p>
        <p data-level="2"><a href="#a55c1249-d7a7-4193-bcc0-abfdab92412a">loader</a></p>
        <p data-level="2"><a href="#b8dfa74a-36a5-4d6f-9f24-5dcb5d334416">plugin</a></p>
        <p data-level="2"><a href="#eff21ce0-991c-425a-bec6-60782be67fd4">mode</a></p>
        <p data-level="2"><a href="#27f87a70-3620-4454-8f1d-669e636d7a18">浏览器兼容性</a></p>
        <p data-level="2"><a href="#5015e27c-c980-4658-9c65-9f789110d40e">环境</a></p>
        <p data-level="1"><a href="#21b3b796-0cec-4935-bc7b-eefd65fd8a00">开发环境</a></p>
        <p data-level="1"><a href="#b85633c3-8ad6-4f93-bd09-4d6403956714">生产环境</a></p>
        <p data-level="1"><a href="#9bdb302a-8baa-423b-a5ea-853db7e2f9db">动态导入</a></p>
        <p data-level="1"><a href="#a8154e85-933c-44d4-b6cd-4ce997bdce6b">预获取/预加载模块</a></p>
        <p data-level="1"><a href="#d4f80f03-a3e9-4776-9ef5-ee816e8df033">缓存</a></p>
        <p data-level="1"><a href="#79b2f074-1ecc-4e16-a94b-e717e4b52e4a">创建 library</a></p>
        <p data-level="1"><a href="#e316656a-2859-4fc5-9b6d-05890605a6e7">优化性能</a></p>
        <p data-level="2"><a href="#14c04e4f-0a33-4e10-aa10-7246e80fa8a7">优化通用环境的性能</a></p>
        <p data-level="3"><a href="#91e46441-290c-4014-8be6-7e9993820a5c">更新版本</a></p>
        <p data-level="3"><a href="#c70f181a-33bd-41fb-98a2-f2640cff6e5b">loader</a></p>
        <p data-level="2"><a href="#8422a093-4e95-43e9-ad06-3e4c6a2a8bb9">优化开发环境的性能</a></p>
        <p data-level="3"><a href="#bd0ad4f6-0321-4546-8dfc-e5a25225cd2c">Devtool</a></p>
        <p data-level="3"><a href="#1fbdff8d-796f-4e46-8182-bde91768f255">避免使用生产环境才需要的工具</a></p>
        <p data-level="3"><a href="#0d79a1ff-2211-49ba-a36f-f3d0c1d128c8">最小化 entry chunk</a></p>
        <p data-level="3"><a href="#96facfe7-5199-45b5-9cec-5576eadcdbad">避免额外的优化步骤</a></p>
        <p data-level="3"><a href="#d7fc7554-b9b8-4ddb-8b1d-2ab34a96c70c">输出结果不携带路径信息</a></p>
        <p data-level="2"><a href="#52766b7b-65ca-4dfc-b757-de303d417092">优化生产环境的性能</a></p>
        <p data-level="3"><a href="#294a86cb-f7c2-4b38-9da3-1c7ea5ebb2cd">Source Maps</a></p>
        <p data-level="2"><a href="#324b257d-c84d-4377-9923-c4de77d4363d">模块热更替</a></p>
        <p data-level="1"><a href="#425a7e4c-8e0b-4f9e-a507-0ac0ba759485">Tree Shaking</a></p>
        <p data-level="1"><a href="#1d6b0cf1-47d4-46a4-b68e-fbfe0e2da26b">懒加载</a></p>
    </aside>
    <article>
        <h1>Webpack 5</h1>
        <p id="last-updated">Last Updated: 25/04/2022</p>
        <h2 id="0182cabf-6d0e-48b5-b06e-2c9c91fa53b6">概念</h2>
        <h3 id="2ef60518-166f-4594-aea5-1d84fb40ad9f">entry</h3>
        <p><code>entry</code> 属性用于指定入口文件，默认值是 <code>./src/index.js</code> 。</p>
        <pre><code class="language-js">module.exports = {
    entry: &quot;./src/index.js&quot;
}
</code></pre>
        <h3 id="ee0f70da-f7b7-439b-960d-278e94f9972a">output</h3>
        <p><code>output</code> 属性用于指定 bundle 的输出地址及命名，默认值是 <code>./dist/main.js</code> ，其他生成文件默认放置在 <code>./dist</code> 文件夹中。</p>
        <pre><code class="language-js">const path = require(&quot;path&quot;);

module.exports = {
    output: {
          path: path.resolve(__dirname, &quot;dist&quot;),
          filename: &quot;bundle.js&quot;
    }
};
</code></pre>
        <h3 id="a55c1249-d7a7-4193-bcc0-abfdab92412a">loader</h3>
        <p>webpack 自身只能识别 JS 和 JSON 文件，如果想让 webpack 识别其他文件，就需要使用 <code>loader</code> 。</p>
        <pre><code class="language-js">const path = require(&quot;path&quot;);

module.exports = {
        module: {
          rules: [ {test: /\.txt$/, use: &quot;raw-loader&quot;} ]
    }
};
</code></pre>
        <p><code>loader</code> 有 2 个属性： <code>test</code> 和 <code>use</code> 。前者用于指定那些文件需要被处理，后者用于指定处理时应使用哪个 loader 。</p>
        <p>上例的意思是：当 webpack 碰到 .txt 文件时，在打包它之前，先使用 <code>raw-loader</code> 处理一下。</p>
        <h3 id="b8dfa74a-36a5-4d6f-9f24-5dcb5d334416">plugin</h3>
        <p><code>loader</code> 用于处理某些类型的文件， <code>plugin</code> 用于执行更宽泛的任务，比如打包优化、资源管理、注入环境变量。</p>
        <pre><code class="language-js">const html_webpack_plugin = require(&quot;html-webpack-plugin&quot;);

module.exports = {
    plugins: [ new html_webpack_plugin() ]
};
</code></pre>
        <h3 id="eff21ce0-991c-425a-bec6-60782be67fd4">mode</h3>
        <p><code>mode</code> 用于指定打包的行为，有 3 种值可选： <code>&quot;development&quot;</code> 、 <code>&quot;production&quot;</code> 、 <code>&quot;none&quot;</code> ，默认值时 <code>&quot;production&quot;</code> 。</p>
        <pre><code class="language-js">module.exports = {
    mode: &quot;production&quot;
};
</code></pre>
        <h3 id="27f87a70-3620-4454-8f1d-669e636d7a18">浏览器兼容性</h3>
        <p>webpack 支持所有符合 ES5 标准的浏览器（不支持 IE8 及以下版本）。 webpack 的 <code>import()</code> 和 <code>require.ensure()</code> 需要 <code>Promise</code> ，如果目标环境不支持 <code>Promise</code> ，那么在使用 <code>import()</code> 和 <code>require.ensure()</code> 之前需要提前进行 polyfill 。</p>
        <h3 id="5015e27c-c980-4658-9c65-9f789110d40e">环境</h3>
        <p>webpack5 要求 Node.js v10.13.0+ 。</p>
        <h2 id="21b3b796-0cec-4935-bc7b-eefd65fd8a00">开发环境</h2>
        <p><code>package.json</code></p>
        <pre><code class="language-json">
</code></pre>
        <p><code>webpack-dev.config.js</code></p>
        <pre><code class="language-js">
</code></pre>
        <h2 id="b85633c3-8ad6-4f93-bd09-4d6403956714">生产环境</h2>
        <p><code>package.json</code></p>
        <pre><code class="language-json">
</code></pre>
        <p><code>webpack-dev.config.js</code></p>
        <pre><code class="language-js">
</code></pre>
        <h2 id="9bdb302a-8baa-423b-a5ea-853db7e2f9db">动态导入</h2>
        <p>学习 webpack 的 <a href="https://webpack.docschina.org/guides/code-splitting/">动态导入</a> ，《现代JavaScript教程》中的 <a href="https://zh.javascript.info/modules-dynamic-imports">动态导入</a> 对你会有额外帮助，也建议学完它的 3 节《模块》的内容。</p>
        <h2 id="a8154e85-933c-44d4-b6cd-4ce997bdce6b">预获取/预加载模块</h2>
        <p>🔗 <a href="https://webpack.docschina.org/guides/code-splitting/">https://webpack.docschina.org/guides/code-splitting/</a></p>
        <h2 id="d4f80f03-a3e9-4776-9ef5-ee816e8df033">缓存</h2>
        <p>浏览器会使用缓存技术来加快网站的加载速度，这带来的一个问题是，如果我们在部署新版本时不更改资源的名称，浏览器就可能会认为它没有被更新，然后继续使用它的缓存版本，这就会带来一些棘手的问题。</p>
        <p>webpack 似乎有一套专业的 <a href="https://webpack.docschina.org/guides/caching/">办法</a> 来解决它，不过为了省事我暂时先使用浏览器的 「停用缓存」功能。</p>
        <h2 id="79b2f074-1ecc-4e16-a94b-e717e4b52e4a">创建 library</h2>
        <p>从这里开始学。</p>
        <p>先看生产环境吧！</p>
        <h2 id="e316656a-2859-4fc5-9b6d-05890605a6e7">优化性能</h2>
        <h3 id="14c04e4f-0a33-4e10-aa10-7246e80fa8a7">优化通用环境的性能</h3>
        <h4 id="91e46441-290c-4014-8be6-7e9993820a5c">更新版本</h4>
        <p>使用最新版本的 <code>webpack</code> 、 <code>node.js</code> 、 <code>npm</code> 都有助于提高构建脚本的性能。</p>
        <h4 id="c70f181a-33bd-41fb-98a2-f2640cff6e5b">loader</h4>
        <p>让 <code>loader</code> 只作用于需要的模块，比如：</p>
        <pre><code class="language-js">module.exports = {
    // ...
    module: {
        rules: [
            {
                test: /\.js$/,
                loader: &quot;babel-loader&quot;,
            },
        ],
    },
};
</code></pre>
        <p>上述配置文件意味着 webpack 会对所有 js 文件都执行 babel ，更改成下述配置文件后，webpack 将只会对 source 目录下的 js 文件执行 babel 。</p>
        <pre><code class="language-js">const path = require(&quot;path&quot;);

module.exports = {
    // ...
    module: {
        rules: [
            {
                test: /\.js$/,
                loader: &quot;babel-loader&quot;,
                include: path.resolve(__dirname, &quot;./source&quot;),
            },
        ],
    },
};
</code></pre>
        <h3 id="8422a093-4e95-43e9-ad06-3e4c6a2a8bb9">优化开发环境的性能</h3>
        <h4 id="bd0ad4f6-0321-4546-8dfc-e5a25225cd2c">Devtool</h4>
        <p> <code>&quot;eval-cheap-module-source-map&quot;</code> 是大多数情况下的最佳选择，它的构建速度快，且可以生成源码的行映射。</p>
        <h4 id="1fbdff8d-796f-4e46-8182-bde91768f255">避免使用生产环境才需要的工具</h4>
        <p>在开发环境下，应该排除一下这些工具，因为它们都只用于生产环境，对开发环境没有意义：</p>
        <ul>
            <li><code>TerserPlugin</code> </li>
            <li><code>[fullhash] / [chunkhash] / [contenthash]</code> </li>
            <li><code>AggressiveSplittingPlugin</code> </li>
            <li><code>AggresiveMergingPlugin</code> </li>
            <li><code>ModuleConcatenationPlugin</code></li>
        </ul>
        <h4 id="0d79a1ff-2211-49ba-a36f-f3d0c1d128c8">最小化 entry chunk</h4>
        <blockquote>
            <p>我不懂它，所以没有使用。</p>
        </blockquote>
        <pre><code class="language-js">module.exports = {
    // ...
    optimization: {
        runtimeChunk: true,
    },
};
</code></pre>
        <h4 id="96facfe7-5199-45b5-9cec-5576eadcdbad">避免额外的优化步骤</h4>
        <p>webpack 通过执行额外的算法任务来优化输出结果的体积和加载性能，这些优化适用于小型代码库，但是不适用于大型代码库，因为这些优化在大型代码库中非常耗费性能。</p>
        <blockquote>
            <p>我不懂它，所以没有使用。</p>
        </blockquote>
        <pre><code class="language-js">module.exports = {
      // ...
      optimization: {
        removeAvailableModules: false,
        removeEmptyChunks: false,
        splitChunks: false,
    },
};
</code></pre>
        <h4 id="d7fc7554-b9b8-4ddb-8b1d-2ab34a96c70c">输出结果不携带路径信息</h4>
        <p>webpack 会在输出的 bundle 中生成路径信息，如果打包的模块有数千个，那么禁用该特性可以减轻垃圾回收的压力，禁用它的方法是：</p>
        <pre><code class="language-js">module.exports = {
    // ...
    output: {
        pathinfo: false
    }
};
</code></pre>
        <h3 id="52766b7b-65ca-4dfc-b757-de303d417092">优化生产环境的性能</h3>
        <h4 id="294a86cb-f7c2-4b38-9da3-1c7ea5ebb2cd">Source Maps</h4>
        <p>source map 相当消耗资源，而且会暴露源码的位置，如果要保护代码的安全，就应该在生产环境中禁用它，禁用后还可以提升一些构建的性能。</p>
        <blockquote>
            <p>代码经 webpack 打包压缩之后，如果发生了异常，控制台是无法输出正确的代码位置的。 source map 用于解决这个问题，它是一个信息文件，它存储了代码打包前后的位置映射关系，有了它，控制台就可以正确的输出异常发生在原始代码的哪个位置了。</p>
        </blockquote>
        <h3 id="324b257d-c84d-4377-9923-c4de77d4363d">模块热更替</h3>
        <blockquote>
            <p>我不知道怎么使用它。</p>
        </blockquote>
        <p>模块热更替（ HMR - hot module replacement ）是一种局部刷新技术，它的作用是：</p>
        <ul>
            <li>保留页面的状态，哪怕重新加载过页面，比如保留复选框的选中状态；</li>
            <li>只更新变更的内容；</li>
            <li>如果源码的 CSS 或 JS 更新了，页面会立刻更新，其速度相当于在浏览器的调试工具中直接更改样式；</li>
            <li>提升构建速度，因为只需要重新构建变更过的模块就行了；</li>
        </ul>
        <blockquote>
            <p>HMR 只适用于开发环境。</p>
        </blockquote>
        <h2 id="425a7e4c-8e0b-4f9e-a507-0ac0ba759485">Tree Shaking</h2>
        <p>它用来剔除无用代码，但我目前没有使用它。</p>
        <h2 id="1d6b0cf1-47d4-46a4-b68e-fbfe0e2da26b">懒加载</h2>
    </article>
</body>

</html>